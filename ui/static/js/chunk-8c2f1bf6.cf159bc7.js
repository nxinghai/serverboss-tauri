(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8c2f1bf6"],{2235:function(e,t,n){},"28e8":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},a=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"init-container"},[n("div",{staticClass:"loader"},[n("div",{staticClass:"dot-container"},[n("div",{staticClass:"dot"}),n("div",{staticClass:"dot"}),n("div",{staticClass:"dot"}),n("div",{staticClass:"dot"}),n("div",{staticClass:"dot"})]),n("div",{staticClass:"loading-text"},[e._v("正在启动，请稍等...")])])])}],c=n("b85c"),s=n("c7eb"),i=n("1da1"),o=(n("2ca0"),n("a15b"),n("ac1f"),n("5319"),n("d3b7"),n("466d"),{name:"hello",data:function(){return{loading:null,info:"",resourcePath:null,appDataPath:null,staticResourceDir:[],staticResourceFile:["dbs/shell.db"],resourceEnv:{dir:null,recursive:!0},baseApiPath:"http://localhost:38888",jarPath:"../../jar/serverboss.jar",dialectCommand:null,child:null,javaPid:null}},created:function(){},methods:{initPath:function(){var e=this;return Object(i["a"])(Object(s["a"])().mark((function t(){var n;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,top.__TAURI__.fs.BaseDirectory.Resource;case 2:return e.resourceEnv.dir=t.sent,t.next=5,e.getDialectCommand();case 5:return e.dialectCommand=t.sent,console.log(e.resourceEnv.dir),t.next=9,top.__TAURI__.path.resourceDir();case 9:return e.resourcePath=t.sent,(e.resourcePath.startsWith("\\\\?\\")||e.resourcePath.startsWith("\\\\.\\"))&&(e.resourcePath=e.resourcePath.substring(4)),console.log("resourcePath:",e.resourcePath),t.next=14,top.__TAURI__.path.localDataDir();case 14:return n=t.sent,t.t0=top.__TAURI__.path,t.t1=n,t.next=19,top.__TAURI__.app.getName();case 19:return t.t2=t.sent,t.next=22,t.t0.join.call(t.t0,t.t1,t.t2);case 22:e.appDataPath=t.sent,console.log("appDataPath:",e.appDataPath);case 24:case"end":return t.stop()}}),t)})))()},processDir:function(e){var t=this;return Object(i["a"])(Object(s["a"])().mark((function n(){var r,a,i,o,u,l,p,d,f;return Object(s["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,top.__TAURI__.path.join(t.appDataPath,e);case 2:return r=n.sent,n.next=5,top.__TAURI__.fs.exists(e,t.resourceEnv);case 5:return a=n.sent,n.next=8,top.__TAURI__.fs.exists(r);case 8:if(i=n.sent,a&&!i){n.next=11;break}return n.abrupt("return");case 11:return n.next=13,top.__TAURI__.fs.createDir(r,{recursive:!0});case 13:return n.next=15,top.__TAURI__.fs.readDir(e,t.resourceEnv);case 15:o=n.sent,u=Object(c["a"])(o),n.prev=17,u.s();case 19:if((l=u.n()).done){n.next=33;break}if(p=l.value,d=p.path,d=d.substring(d.indexOf(t.resourcePath),d.length),f=d.replace(t.resourcePath,""),p.children){n.next=29;break}return n.next=27,t.processFile(f);case 27:n.next=31;break;case 29:return n.next=31,t.processDir(f);case 31:n.next=19;break;case 33:n.next=38;break;case 35:n.prev=35,n.t0=n["catch"](17),u.e(n.t0);case 38:return n.prev=38,u.f(),n.finish(38);case 41:case"end":return n.stop()}}),n,null,[[17,35,38,41]])})))()},processFile:function(e){var t=this;return Object(i["a"])(Object(s["a"])().mark((function n(){var r,a,c,i,o;return Object(s["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,top.__TAURI__.fs.exists(e,t.resourceEnv);case 2:return r=n.sent,n.next=5,top.__TAURI__.path.join(t.appDataPath,e);case 5:return a=n.sent,n.next=8,top.__TAURI__.fs.exists(a);case 8:if(c=n.sent,r&&!c){n.next=11;break}return n.abrupt("return");case 11:return n.next=13,top.__TAURI__.path.dirname(a);case 13:return i=n.sent,n.next=16,top.__TAURI__.fs.createDir(i,{recursive:!0});case 16:return n.next=18,top.__TAURI__.path.join(t.resourcePath,e);case 18:return o=n.sent,n.next=21,top.__TAURI__.fs.copyFile(o,a);case 21:case"end":return n.stop()}}),n)})))()},startJar:function(){var e=this;return Object(i["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=Object(i["a"])(Object(s["a"])().mark((function t(n,r){var a,c,i,o,u;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.testJar();case 2:if(a=t.sent,console.log("testResult : "+a),c={isConn:!0,pid:null},!a){t.next=9;break}return c.isConn=!0,n(c),t.abrupt("return");case 9:if(e.dialectCommand){t.next=12;break}return r(new Error("不支持的系统")),t.abrupt("return");case 12:return t.next=14,top.__TAURI__.path.join(e.resourcePath,"jre","bin");case 14:return i=t.sent,console.log("commandPath",i),t.prev=16,o=new top.__TAURI__.shell.Command(e.dialectCommand.startJava.cmd,e.dialectCommand.startJava.command("-DLOCALAPPDATA=".concat(e.appDataPath)),{cwd:i}),o.on("error",console.error),o.stderr.on("data",console.error),u=/pid=(\d+)/,o.stdout.on("data",(function(t){var a=t.match(u);if(a&&(e.javaPid=a[1]),-1!==t.indexOf("App: End loading"))return c.isConn=!0,c.pid=e.javaPid,void n(c);-1===t.indexOf("Exception")||r(t)})),t.next=24,o.spawn();case 24:e.child=t.sent,t.next=31;break;case 27:t.prev=27,t.t0=t["catch"](16),console.error("command error",t.t0),r(t.t0);case 31:case"end":return t.stop()}}),t,null,[[16,27]])})));return function(e,n){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})))()},testJar:function(){var e=this;return Object(i["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){fetch("".concat(e.baseApiPath,"/ssh/manage/ping")).then((function(e){t(200==e.status)})).catch((function(e){return t(!1)})),setTimeout((function(){t(!1)}),500)})));case 1:case"end":return t.stop()}}),t)})))()},getDialectCommand:function(){var e=this;return Object(i["a"])(Object(s["a"])().mark((function t(){var n,r;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=navigator.userAgent,r=top.__TAURI__.shell,-1===n.indexOf("Windows",0)){t.next=4;break}return t.abrupt("return",{killJava:function(e){return new r.Command("cmd",["/c taskkill /pid ".concat(e," /f")])},startJava:{cmd:"cmd",command:function(t){return["/C","java","-jar","-Dfile.encoding=utf-8","".concat(t),"".concat(e.jarPath)]}}});case 4:if(-1===n.indexOf("Linux",0)){t.next=6;break}return t.abrupt("return",{killJava:function(e){return new r.Command("kill",["-9 ".concat(e)])},startJava:{cmd:"./java",command:function(t){return["-jar","-Dfile.encoding=utf-8","".concat(t),"".concat(e.jarPath)]}}});case 6:if(-1===n.indexOf("Mac",0)){t.next=8;break}return t.abrupt("return",{killJava:function(e){return new r.Command("kill",["-9 ".concat(e)])},startJava:{cmd:"./java",command:function(t){return["-jar","-Dfile.encoding=utf-8","".concat(t),"".concat(e.jarPath)]}}});case 8:case"end":return t.stop()}}),t)})))()},closeWindow:function(){var e=this;return Object(i["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:top.__TAURI__.window.getCurrent().onCloseRequested(function(){var t=Object(i["a"])(Object(s["a"])().mark((function t(n){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.javaPid||!e.dialectCommand){t.next=8;break}return t.prev=1,t.next=4,e.dialectCommand.killJava(e.javaPid).execute();case 4:t.next=8;break;case 6:t.prev=6,t.t0=t["catch"](1);case 8:if(!e.child){t.next=13;break}return t.next=11,e.child.kill();case 11:t.next=14;break;case 13:top.__TAURI__.tauri.invoke("window_close",{pid:e.javaPid});case 14:case"end":return t.stop()}}),t,null,[[1,6]])})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})))()},goIndex:function(){this.$router.push({path:"/index"})}},mounted:function(){var e=this;return Object(i["a"])(Object(s["a"])().mark((function t(){var n,r,a,i,o,u;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!top.__TAURI__){t.next=51;break}return document.oncontextmenu=function(){return!1},t.prev=2,t.next=5,e.initPath();case 5:n=Object(c["a"])(e.staticResourceDir),t.prev=6,n.s();case 8:if((r=n.n()).done){t.next=14;break}return a=r.value,t.next=12,e.processDir(a);case 12:t.next=8;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](6),n.e(t.t0);case 19:return t.prev=19,n.f(),t.finish(19);case 22:i=Object(c["a"])(e.staticResourceFile),t.prev=23,i.s();case 25:if((o=i.n()).done){t.next=31;break}return u=o.value,t.next=29,e.processFile(u);case 29:t.next=25;break;case 31:t.next=36;break;case 33:t.prev=33,t.t1=t["catch"](23),i.e(t.t1);case 36:return t.prev=36,i.f(),t.finish(36);case 39:return t.next=41,e.startJar().then((function(t){t&&t.isConn&&e.goIndex()}));case 41:return t.next=43,e.closeWindow();case 43:t.next=49;break;case 45:t.prev=45,t.t2=t["catch"](2),e.info="出错了...... : ".concat(t.t2),console.error("Error:",t.t2);case 49:t.next=52;break;case 51:e.goIndex();case 52:case"end":return t.stop()}}),t,null,[[2,45],[6,16,19,22],[23,33,36,39]])})))()}}),u=o,l=(n("4ebd"),n("2877")),p=Object(l["a"])(u,r,a,!1,null,"3b118ef2",null);t["default"]=p.exports},"4ebd":function(e,t,n){"use strict";n("2235")}}]);